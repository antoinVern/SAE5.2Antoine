<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>CyberMonitor Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #0f172a; /* Bleu nuit tr√®s sombre (Pro) */
            color: #334155;
            font-family: 'Inter', system-ui, sans-serif;
            min-height: 100vh;
        }

        /* Navbar style */
        .navbar-brand { font-weight: 700; color: white !important; letter-spacing: 1px; }
        .nav-pills .nav-link { color: #94a3b8; border-radius: 6px; padding: 10px 20px; font-weight: 500; }
        .nav-pills .nav-link.active { background-color: #3b82f6; color: white; }
        .nav-pills .nav-link:hover:not(.active) { background-color: #1e293b; color: white; }

        /* Card Design */
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .card-header {
            background-color: white;
            border-bottom: 1px solid #e2e8f0;
            font-weight: 600;
            padding: 15px 20px;
            border-radius: 12px 12px 0 0 !important;
        }
        
        .score-circle {
            position: relative; width: 150px; height: 150px; margin: 0 auto;
        }
        .score-text {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 2.5rem; font-weight: 800; color: #0f172a;
        }

        /* Loader */
        #loader {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.9); z-index: 999;
            justify-content: center; align-items: center; flex-direction: column; color: white;
        }
    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status"></div>
        <p class="mt-3">Audit en cours...</p>
    </div>

    <nav class="navbar navbar-dark bg-transparent py-4 border-bottom border-secondary border-opacity-25">
        <div class="container">
            <span class="navbar-brand"><i class="fas fa-shield-alt me-2"></i> CYBERMONITOR PRO</span>
        </div>
    </nav>

    <div class="container mt-5">
        
        <div class="row justify-content-center mb-5">
            <div class="col-md-8">
                <form method="POST" onsubmit="document.getElementById('loader').style.display='flex'">
                    <div class="input-group input-group-lg shadow-sm">
                        <span class="input-group-text bg-white border-0"><i class="fas fa-search text-muted"></i></span>
                        <input type="text" name="target" class="form-control border-0" placeholder="(IP, URL longue, Domaine)" value="{{ target }}" required>
                        <button class="btn btn-primary px-4 fw-bold" type="submit">LANCER L'AUDIT</button>
                    </div>
                </form>
            </div>
        </div>

        {% if report %}
        
        <ul class="nav nav-pills mb-4 justify-content-center" id="pills-tab" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" id="tab-dashboard" data-bs-toggle="pill" data-bs-target="#content-dashboard" type="button">üìä Vue d'ensemble</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="tab-network" data-bs-toggle="pill" data-bs-target="#content-network" type="button">üåê R√©seau</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="tab-security" data-bs-toggle="pill" data-bs-target="#content-security" type="button">üîí S√©curit√© Web</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="tab-identity" data-bs-toggle="pill" data-bs-target="#content-identity" type="button">üè¢ Identit√© & DNS</button>
            </li>
        </ul>

        <div class="tab-content" id="pills-tabContent">
            
            <div class="tab-pane fade show active" id="content-dashboard">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card h-100 text-center py-4">
                            <h5 class="text-muted mb-4">Note de S√©curit√©</h5>
                            <div class="score-circle">
                                <canvas id="scoreChart"></canvas>
                                <div class="score-text">{{ report.score }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card h-100">
                            <div class="card-header">Synth√®se Rapide</div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-6">
                                        <div class="p-3 border rounded bg-light">
                                            <small class="text-muted d-block">Disponibilit√©</small>
                                            <strong class="text-{{ report.ping.col }}">{{ report.ping.txt }}</strong>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="p-3 border rounded bg-light">
                                            <small class="text-muted d-block">Certificat SSL</small>
                                            <strong class="text-{{ report.ssl.col }}">{{ report.ssl.txt }}</strong>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="p-3 border rounded bg-light">
                                            <small class="text-muted d-block">Localisation</small>
                                            {% if report.geoip.code != 'UNK' %}
                                                <img src="https://flagcdn.com/20x15/{{ report.geoip.code|lower }}.png" class="me-2">
                                            {% endif %}
                                            <strong>{{ report.geoip.txt }}</strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="content-network">
                <div class="card">
                    <div class="card-header">Infrastructure & Ports</div>
                    <div class="card-body">
                        <table class="table table-hover">
                            <thead><tr><th>Service</th><th>Port</th><th>√âtat</th></tr></thead>
                            <tbody>
                                <tr>
                                    <td><i class="fas fa-server me-2 text-primary"></i> Serveur Web</td>
                                    <td>80 (HTTP)</td>
                                    <td>{% if report.ports.http %}<span class="badge bg-success">OUVERT</span>{% else %}<span class="badge bg-secondary">FERM√â</span>{% endif %}</td>
                                </tr>
                                <tr>
                                    <td><i class="fas fa-lock me-2 text-primary"></i> Serveur S√©curis√©</td>
                                    <td>443 (HTTPS)</td>
                                    <td>{% if report.ports.https %}<span class="badge bg-success">OUVERT</span>{% else %}<span class="badge bg-secondary">FERM√â</span>{% endif %}</td>
                                </tr>
                                <tr>
                                    <td><i class="fas fa-terminal me-2 text-primary"></i> Administration</td>
                                    <td>22 (SSH)</td>
                                    <td>{% if report.ports.ssh %}<span class="badge bg-danger">EXPOS√â ‚ö†Ô∏è</span>{% else %}<span class="badge bg-success">S√âCURIS√â</span>{% endif %}</td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="alert alert-info mt-3 mb-0">
                            <i class="fas fa-info-circle me-2"></i> Adresse IP d√©tect√©e : <strong>{{ report.ip }}</strong>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="content-security">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header">En-t√™tes de S√©curit√© (HTTP Headers)</div>
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    {% for name, res in report.headers.items() %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        {{ name }}
                                        {% if res.ok %}
                                            <i class="fas fa-check-circle text-success" title="{{ res.val }}"></i>
                                        {% else %}
                                            <i class="fas fa-times-circle text-danger"></i>
                                        {% endif %}
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header">Protection Email (Anti-Spoofing)</div>
                            <div class="card-body text-center">
                                <div class="row mt-4">
                                    <div class="col-6">
                                        <h5>SPF</h5>
                                        {% if report.email.spf %}
                                            <i class="fas fa-shield-check fa-3x text-success mb-2"></i><br>Active
                                        {% else %}
                                            <i class="fas fa-shield-virus fa-3x text-secondary mb-2"></i><br>Manquant
                                        {% endif %}
                                    </div>
                                    <div class="col-6">
                                        <h5>DMARC</h5>
                                        {% if report.email.dmarc %}
                                            <i class="fas fa-shield-check fa-3x text-success mb-2"></i><br>Active
                                        {% else %}
                                            <i class="fas fa-shield-virus fa-3x text-secondary mb-2"></i><br>Manquant
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="content-identity">
                <div class="card">
                    <div class="card-header">Informations Whois</div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 text-center border-end">
                                <h6 class="text-muted">Registrar</h6>
                                <p class="fw-bold">{{ report.whois.registrar }}</p>
                            </div>
                            <div class="col-md-4 text-center border-end">
                                <h6 class="text-muted">Date de cr√©ation</h6>
                                <p class="fw-bold">{{ report.whois.date }}</p>
                            </div>
                            <div class="col-md-4 text-center">
                                <h6 class="text-muted">Anciennet√©</h6>
                                <p class="fw-bold text-primary">{{ report.whois.age }} jours</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        {% endif %}

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    {% if report %}
    <script>
        const ctx = document.getElementById('scoreChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [{{ report.score }}, {{ 100 - report.score }}],
                    backgroundColor: ['#3b82f6', '#e2e8f0'],
                    borderWidth: 0,
                    cutout: '85%'
                }]
            },
            options: { tooltips: {enabled: false}, hover: {mode: null} }
        });
    </script>
    {% endif %}
</body>
</html>